<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="C++ move semantics benefits" /><meta property="og:locale" content="en" /><meta name="description" content="In a previous post, I talked about every kind of constructors modern C++ offers. I briefly introduces move constructors. Here I’m going to explain move semantics and why it’s so useful." /><meta property="og:description" content="In a previous post, I talked about every kind of constructors modern C++ offers. I briefly introduces move constructors. Here I’m going to explain move semantics and why it’s so useful." /><link rel="canonical" href="blog.x99.fr/posts/move-semantics/" /><meta property="og:url" content="blog.x99.fr/posts/move-semantics/" /><meta property="og:site_name" content="X99’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-15T21:10:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="C++ move semantics benefits" /><meta name="twitter:site" content="@therealX99" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-15T23:17:44+01:00","datePublished":"2022-12-15T21:10:00+01:00","description":"In a previous post, I talked about every kind of constructors modern C++ offers. I briefly introduces move constructors. Here I’m going to explain move semantics and why it’s so useful.","headline":"C++ move semantics benefits","mainEntityOfPage":{"@type":"WebPage","@id":"blog.x99.fr/posts/move-semantics/"},"url":"blog.x99.fr/posts/move-semantics/"}</script><title>C++ move semantics benefits | X99's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="X99's blog"><meta name="application-name" content="X99's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">X99's blog</a></div><div class="site-subtitle font-italic">A part of my brain lives here</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://gitlab.com/X99" aria-label="Gitlab" target="_blank" rel="noopener"> <i class="fab fa-gitlab"></i> </a> <a href="https://github.com/p-vernaeckt" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/therealX99" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/pierre-vernaeckt/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/754798/x99" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>C++ move semantics benefits</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>C++ move semantics benefits</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1671135000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 15, 2022 </em> </span> <span> Updated <em class="" data-ts="1671142664" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 15, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/therealX99">X99</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1080 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>In a <a href="/posts/Cpp-object-lifetime/">previous post</a>, I talked about every kind of constructors modern C++ offers. I briefly introduces move constructors. Here I’m going to explain move semantics and why it’s so useful.</p><h1 id="comparing-the-performance-of-copying-and-moving-stdstring-objects">Comparing the Performance of Copying and Moving std::string Objects</h1><p>C++11 introduced the std::move function, which allows objects to be moved instead of copied. Moving an object is more efficient than copying it because it involves simply transferring ownership of the object’s underlying resources, rather than creating a new copy of the object’s data. However, not all objects can be moved, and in some cases, it may still be more efficient to copy an object instead of moving it.</p><p>In this blog post, we will compare the performance of copying and moving std::string objects, which are a common type of object that can be moved in C++. We will use a simple benchmark to measure the time it takes to copy and move std::string objects of various sizes, and we will discuss the implications of the benchmark results.</p><h2 id="benchmark-setup"><span class="mr-2">Benchmark Setup</span><a href="#benchmark-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To compare the performance of copying and moving std::string objects, we will use the following benchmark setup:</p><ul><li>We will use the std::chrono library to measure the elapsed time of each operation.<li>We will create a std::string object of a reasonable size.<li>We will measure the time it takes to copy and move each std::string object N times.</ul><h2 id="bench-code"><span class="mr-2">Bench code</span><a href="#bench-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="p">;</span>

<span class="k">constexpr</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// measure the time it takes to copy the string N times</span>
    <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"this is a test string. Let's make it long so the compiler cannot optimize it."</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">copy</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">copy_time</span> <span class="o">=</span> <span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span>

    <span class="c1">// measure the time it takes to move the string N times</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"this is a test string. Let's make it long so the compiler cannot optimize it."</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">moved</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">move_time</span> <span class="o">=</span> <span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span>

    <span class="c1">// print the results</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Copy time: "</span> <span class="o">&lt;&lt;</span> <span class="n">copy_time</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" microseconds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Move time: "</span> <span class="o">&lt;&lt;</span> <span class="n">move_time</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" microseconds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note: for each test I declare an instance of <code class="language-plaintext highlighter-rouge">str</code>. While this is clearly sub-optimal in a real-world context, there is a reason why in this particular one. Indeed, when <code class="language-plaintext highlighter-rouge">str</code> is moved to <code class="language-plaintext highlighter-rouge">moved</code>, its content is transfered. Creating <code class="language-plaintext highlighter-rouge">str</code> outside the loop would result in the string being moved on the first time, then only an empty shell for each next turn, making the results wrong.</p><h2 id="benchmark-results"><span class="mr-2">Benchmark Results</span><a href="#benchmark-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After running the program a few times, I obtained the following result:</p><div class="table-wrapper"><table><thead><tr><th>Version<th>Average time (microseconds)<tbody><tr><td>Copy<td>801<tr><td>Move<td>438</table></div><h2 id="first-conclusion"><span class="mr-2">First conclusion</span><a href="#first-conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With this first example, we can see how our code benefits from move semantics: moving an object instead of copying if take way, way less time.</p><p>But wait, there is more…</p><p><code class="language-plaintext highlighter-rouge">std::string</code> can contain way more than a few words.</p><h1 id="pushing-stdstring-a-bit-further">Pushing <code class="language-plaintext highlighter-rouge">std::string</code> a bit further</h1><h2 id="about-stdstrings-capacity"><span class="mr-2">About <code class="language-plaintext highlighter-rouge"><span class="mr-2">std::string</code>’s capacity</span><a href="#about-stdstrings-capacity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The maximum capacity of a <code class="language-plaintext highlighter-rouge">std::string</code> object is determined by the amount of memory available on the system. This means that the maximum capacity of a <code class="language-plaintext highlighter-rouge">std::string</code> object can vary depending on the hardware and software environment in which the program is run.</p><p>In general, the maximum capacity of a <code class="language-plaintext highlighter-rouge">std::string</code> object is the largest value that can be represented by the <code class="language-plaintext highlighter-rouge">size_type</code> of the <code class="language-plaintext highlighter-rouge">std::string</code> class, which is an implementation-defined unsigned integer type. For example, on many systems, the <code class="language-plaintext highlighter-rouge">size_type</code> of <code class="language-plaintext highlighter-rouge">std::string</code> is an <code class="language-plaintext highlighter-rouge">unsigned int</code>, which means that the maximum capacity of a <code class="language-plaintext highlighter-rouge">std::string</code> object is the largest value that can be represented by an <code class="language-plaintext highlighter-rouge">unsigned int</code>, which is typically around 4 billion on a 32-bit system and around 18 billion on a 64-bit system.</p><p>However, even if the maximum capacity of a <code class="language-plaintext highlighter-rouge">std::string</code> object is very large, it is important to note that the actual amount of memory that can be allocated for a <code class="language-plaintext highlighter-rouge">std::string</code> object is limited by the amount of available memory on the system. This means that even if the maximum capacity of a <code class="language-plaintext highlighter-rouge">std::string</code> object is very large, it may not be possible to create a <code class="language-plaintext highlighter-rouge">std::string</code> object with that capacity if there is not enough memory available on the system.</p><p>In general, it is recommended to avoid creating very large <code class="language-plaintext highlighter-rouge">std::string</code> objects, as they can consume a significant amount of memory and may cause performance issues. Instead, it is often better to use other data structures, such as <code class="language-plaintext highlighter-rouge">std::vector</code>, which can dynamically resize their internal storage as needed without consuming excessive amounts of memory.</p><h2 id="testing-move-vs-copy-with-increasingly-large-stdstring"><span class="mr-2">Testing move vs copy with increasingly large <code class="language-plaintext highlighter-rouge"><span class="mr-2">std::string</code></span><a href="#testing-move-vs-copy-with-increasingly-large-stdstring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s reuse the previous code, but this time with small to huge <code class="language-plaintext highlighter-rouge">std::string</code> instances:</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span>
<span class="k">const</span> <span class="kt">uint64_t</span> <span class="n">STR_LENGTHS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">10</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span>
    <span class="mi">1000</span><span class="p">,</span>
    <span class="mi">10000</span><span class="p">,</span>
    <span class="mi">100000</span><span class="p">,</span>
    <span class="mi">1000000</span><span class="p">,</span>
    <span class="mi">10000000</span><span class="p">,</span>
    <span class="mi">100000000</span><span class="p">,</span>
    <span class="mi">1000000000</span><span class="p">};</span>

<span class="kt">void</span> <span class="n">test_move_copy</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Measure the time it takes to copy the string</span>
    <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">copied_str</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">elapsed_copy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span>

    <span class="c1">// Measure the time it takes to move the string</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">moved_str</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">elapsed_move</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span>

    <span class="c1">// Output the results</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Copy time: "</span> <span class="o">&lt;&lt;</span> <span class="n">elapsed_copy</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" microseconds"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Move time: "</span> <span class="o">&lt;&lt;</span> <span class="n">elapsed_move</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" microseconds"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Test move vs copy for strings of different lengths</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">length</span> <span class="o">:</span> <span class="n">STR_LENGTHS</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"String length: "</span> <span class="o">&lt;&lt;</span> <span class="n">length</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="sc">'x'</span><span class="p">);</span>
        <span class="n">test_move_copy</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>

        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="results"><span class="mr-2">Results</span><a href="#results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/posts/2022-12-15-move-semantics/chart.png" alt="Chart" data-proofer-ignore></p><p>This chart clearly demonstrates the benefits of move semantics when using very large objects. Copying an instance of <code class="language-plaintext highlighter-rouge">std::string</code> takes a linear amount of time. Moving, however, takes a constant, almost negligible amount of time.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/c/'>C++</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >c++</a> <a href="/tags/move-semantics/" class="post-tag no-text-decoration" >move semantics</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=C%2B%2B+move+semantics+benefits+-+X99%27s+blog&url=blog.x99.fr%2Fposts%2Fmove-semantics%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=C%2B%2B+move+semantics+benefits+-+X99%27s+blog&u=blog.x99.fr%2Fposts%2Fmove-semantics%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=blog.x99.fr%2Fposts%2Fmove-semantics%2F&text=C%2B%2B+move+semantics+benefits+-+X99%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=blog.x99.fr%2Fposts%2Fmove-semantics%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/move-semantics/">C++ move semantics benefits</a><li><a href="/posts/Cpp-object-lifetime/">C++ objects lifetime</a><li><a href="/posts/Hyperfine/">Hyperfine, a better version of time</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/zsh/">zsh</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/intel/">intel</a> <a class="post-tag" href="/tags/move-semantics/">move semantics</a> <a class="post-tag" href="/tags/object-lifetime/">object lifetime</a> <a class="post-tag" href="/tags/pcloud/">pcloud</a> <a class="post-tag" href="/tags/sgx/">sgx</a> <a class="post-tag" href="/tags/time/">time</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Cpp-object-lifetime/"><div class="card-body"> <em class="small" data-ts="1671105060" data-df="ll" > Dec 15, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++ objects lifetime</h3><div class="text-muted small"><p> Object lifetime in C++ refers to the time during which an object exists and is accessible in a program. Understanding object lifetime is important because it affects the behavior of a program and c...</p></div></div></a></div><div class="card"> <a href="/posts/Hyperfine/"><div class="card-body"> <em class="small" data-ts="1663000200" data-df="ll" > Sep 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hyperfine, a better version of time</h3><div class="text-muted small"><p> Sick of boring time command? Sure, there is nothing very exciting about this one, even if it does its job quite well: Here is Hyperfine, a drop-in replacement for time written in Rust that offer...</p></div></div></a></div><div class="card"> <a href="/posts/Setting-up-Intel-SGX/"><div class="card-body"> <em class="small" data-ts="1662998400" data-df="ll" > Sep 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Setting up Intel SGX on Ubuntu</h3><div class="text-muted small"><p> Intel’s Software Guard Extension is a CPU instruction set that allows you to run sensitive code into an encrypted part of memory called an enclave. This enclave is completely isolated from the rest...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Cpp-object-lifetime/" class="btn btn-outline-primary" prompt="Older"><p>C++ objects lifetime</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = ''; this.page.identifier = '/posts/move-semantics/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://x99.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/therealX99">X99</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/zsh/">zsh</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/intel/">intel</a> <a class="post-tag" href="/tags/move-semantics/">move semantics</a> <a class="post-tag" href="/tags/object-lifetime/">object lifetime</a> <a class="post-tag" href="/tags/pcloud/">pcloud</a> <a class="post-tag" href="/tags/sgx/">sgx</a> <a class="post-tag" href="/tags/time/">time</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-9JTBQN7SD3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9JTBQN7SD3'); }); </script>
